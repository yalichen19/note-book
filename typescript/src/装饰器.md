# 装饰器

## 概述
> 面向对象的概念（jave：注解，C#：特征），decorator
> angular大量使用，react中也会用到
> 目前 js 支持装饰器，处于建议征集的第二阶段

### 解决的问题
装饰器，分离关注点
- 关注点的问题，在定义某个东西时，应该最清楚该东西的情况，但却不能直接附加在上面，只能通过校验函数等来约束
- 重复代码的问题

---> 有了装饰器，就可以在类定义时只描述规则，具体的验证过程交给统一的函数处理

上述两个问题产生的根源：某些信息，在定义的时候能够附加的信息量有限

装饰器的作用：为某些属性、类、参数、方法提供元数据信息（metadata）

元数据：描述数据的数据，例如 html 的meda标签

### 装饰器的本质
在 js 中，装饰器是一个函数。装饰器是要参与运行的。
装饰器可以修饰：
- 类
- 成员（属性和方法）
- 参数

## 类装饰器

类装饰器的本质是一个函数，该函数接受一个参数，表示类本身（构造函数本身）

使用装饰器：`@得到一个函数`

在 ts 中，如何约束一个变量为类
- Function
- `new (...args: any[]) => object`

装饰器函数的运行时间：在类定义后直接运行

类装饰器可以具有的返回值

- void：仅运行函数
- 返回一个新的类，会将新的类替换掉装饰目标

多个装饰器的情况：按照后加入先调用的顺序调用

## 成员装饰器

- 属性
属性的装饰器也是一个函数，该函数需要两个参数：
1. 如果是静态属性，则为类本身；如果是实例属性，则为类的原型
2. 固定为字符串，表示属性名

- 方法
方法的装饰器也是一个函数，该函数需要三个参数：
1. 如果是静态方法，则为类本身；如果是实例方法，则为类的原型
2. 固定为字符串，表示方法名
3. 属性描述对象 （和 Object.defineProperty 第三个参数类似）

可以多个装饰器修饰

## reflect-metadata 库
该库的作用：保存元数据

## class-validator 库 class-transformer

## 补充
- 参数装饰器
依赖注入，依赖倒置
要求函数有三个参数：
1. 如果方法是静态的，则为类本身；如果方法是示例方法，则为类的原型
2. 方法名称
3. 在参数列表中的索引

- 关于TS自动注入的元数据
如果安装了 `reflect-metadata` 并且导入了该库，并且在某个成员加上了元数据，并且开启了 `emitDecoratorMetadata`

则 TS 在编译结果中，会将约束的类型，作为元数据加入相应位置

这样一来，TS的类型检查（约束）将有机会在运行时进行。

- AOP（aspect oriented programing)
编程方式，属于面向对象开发。
将一些在业务中共同出现的功能块，横行切分，已达到分离关注点的目的。
